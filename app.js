/* Telegram Mini App SPA */
(function(){
  const tg = window.Telegram?.WebApp;
  const state = {
    currentTab: 'home',
    projects: [
      {
        id:'food',
        title:'–î–æ—Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ –¥–æ–º',
        cardTitle:'–î–æ—Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤',
        tag:'iOS/Android',
        desc:'–°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞–∫–∞–∑–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ –¥–æ–º, —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ø–ª–∞—Ç–µ–∂–µ–π, –∫–æ—Ä–∑–∏–Ω–æ–π –ø–æ–∫—É–ø–æ–∫ –∏ —Å–∏—Å—Ç–µ–º–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π. –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –Ω–∞ iOS –∏ Android',
        cover:'assets/food-cover.png',
        gallery:['assets/food-1.png','assets/food-2.png','assets/food-3.png']
      },
      {
        id:'pet',
        title:'–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏—é—Ç –¥–ª—è –∂–∏–≤–æ—Ç–Ω—ã—Ö',
        cardTitle:'–ü—Ä–∏—é—Ç –¥–ª—è –∂–∏–≤–æ—Ç–Ω—ã—Ö',
        tag:'iOS/Android',
        desc:'–ó–¥–µ—Å—å –∂–µ–ª–∞—é—â–∏–π —Å–ø–∞—Å—Ç–∏ –∂–∏–≤–æ—Ç–Ω–æ–µ —É–∂–µ –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –±—É–¥—É—â–µ–≥–æ –ø–∏—Ç–æ–º—Ü–∞. –ù–∞–¥–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –ø–æ–∏—Å–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Ç–æ—á–Ω–æ—Å—Ç–∏, –∫–∞–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤ Tinder. –¢–æ–ª—å–∫–æ –≤–º–µ—Å—Ç–æ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö –∞–≤–∞—Ç–∞—Ä–æ–∫ - —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –º–∏–ª—ã—Ö –∑–≤–µ—Ä—É—à–µ–∫. –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –Ω–∞ iOS –∏ Android',
        cover:'assets/pets-cover.png',
        gallery:['assets/pets-1.png','assets/pets-2.png']
      },
      {
        id:'asia',
        title:'–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –∞–∑–∏–∞—Ç—Å–∫–æ–π –∫—É—Ö–Ω–∏',
        cardTitle:'–ê–∑–∏–∞—Ç—Å–∫–∏–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω',
        tag:'iOS/Android',
        desc:'–° –ø–æ–º–æ—â—å—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤—ã —Å–º–æ–∂–µ—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –±–ª—é–¥–∞ –∞–∑–∏–∞—Ç—Å–∫–æ–π –∫—É—Ö–Ω–∏: —Å—É—à–∏, —Ä–æ–ª–ª—ã, –≤–æ–∫, —Å—É–ø, –∞–∑–∏–∞—Ç—Å–∫–∏–µ –ø–µ–ª—å–º–µ–Ω–∏. –¢–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Ä–µ—Ü–µ–ø—Ç—É—Ä–∞ –∏ 100% –∫–∞—á–µ—Å—Ç–≤–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤. –ö–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–≤–∞—Ä–∞ —è–ø–æ–Ω—Å–∫–æ–π, –∫–∏—Ç–∞–π—Å–∫–æ–π –∏ –≤—å–µ—Ç–Ω–∞–º—Å–∫–æ–π –∫—É—Ö–Ω–∏. –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –Ω–∞ iOS –∏ Android',
        cover:'assets/1s-cover.png',
        gallery:['assets/1s.png','assets/2s.png','assets/3s.png','assets/4s.png']
      },
      {
        id:'job',
        title:'–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–∞–±–æ—Ç—ã',
        cardTitle:'–ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç—ã',
        tag:'iOS/Android',
        desc:'–ë–∞–∑–∞ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–π –∏ —Å–æ–∏—Å–∫–∞—Ç–µ–ª–µ–π, —Å –ª–∏—á–Ω—ã–º –∫–∞–±–∏–Ω–µ—Ç–æ–º –∏ —Å–∏—Å—Ç–µ–º–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π. –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –Ω–∞ iOS –∏ Android',
        cover:'assets/job-cover.png',
        gallery:['assets/job-1.png','assets/job-2.png','assets/job-3.png']
      }
    ],
    services:[
      {emoji:'üì±', title:'–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ iOS –∏ Android'},
      {emoji:'ü™™', title:'–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ Telegram Mini App'},
      {emoji:'üé®', title:'UI/UX –¥–∏–∑–∞–π–Ω'},
      {emoji:'üîß', title:'–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞'},
      {emoji:'üìä', title:'–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è'},
    ],
    technologies:[
      {emoji:'ü¶ã', name:'Flutter', level:'90%'},
      {emoji:'üçé', name:'Swift', level:'75%'},
      {emoji:'ü§ñ', name:'Kotlin', level:'70%'},
      {emoji:'üî•', name:'Firebase', level:'85%'}
    ]
  };

  // –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
  const analytics = {
    startTime: Date.now(),
    screenStartTime: Date.now(),
    currentScreen: 'home',
    
    track(eventName, properties = {}) {
      if (tg) {
        const eventData = {
          action: 'analytics',
          event: eventName,
          properties: {
            ...properties,
            timestamp: Date.now(),
            user_id: tg.initDataUnsafe?.user?.id,
            language: tg.initDataUnsafe?.user?.language_code,
            platform: tg.platform,
            version: tg.version,
            session_duration: Date.now() - this.startTime
          }
        };
        
        try {
          tg.sendData(JSON.stringify(eventData));
        } catch (e) {
          console.log('Analytics error:', e);
        }
      }
    },
    
    trackScreenView(screenName) {
      // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —ç–∫—Ä–∞–Ω–µ
      if (this.currentScreen !== screenName) {
        const timeOnScreen = Date.now() - this.screenStartTime;
        this.track('screen_time', { 
          screen: this.currentScreen, 
          duration: timeOnScreen 
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —ç–∫—Ä–∞–Ω –∏ –≤—Ä–µ–º—è
        this.currentScreen = screenName;
        this.screenStartTime = Date.now();
      }
      
      this.track('screen_view', { screen: screenName });
    },
    
    trackProjectView(projectId) {
      this.track('project_view', { project_id: projectId });
    },
    
    trackInteraction(action, details = {}) {
      this.track('interaction', { action, ...details });
    },
    
    trackPerformance(metric, value) {
      this.track('performance', { metric, value });
    }
  };

  function initTelegram(){
    if(!tg) return;
    tg.ready();
    tg.expand();
    tg.setHeaderColor('#0d0d0d');
    tg.setBackgroundColor('#0d0d0d');

    // –°–∫—Ä—ã–≤–∞–µ–º MainButton –Ω–∞–≤—Å–µ–≥–¥–∞
    tg.MainButton.hide();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è Telegram Web App —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Å—Ç–∏–ª–µ–π
    document.body.classList.add('telegram-webapp');
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–±–∞—Ä–∞ –≤ Telegram
    if (tg.platform === 'ios' || tg.platform === 'android') {
      setTimeout(() => {
        const tabbar = document.querySelector('.tabbar');
        const tabs = document.querySelectorAll('.tab');
        
        if (tabbar) {
          tabbar.style.overflow = 'hidden';
          tabbar.style.contain = 'layout style paint';
          tabbar.style.isolation = 'isolate';
        }
        
        tabs.forEach(tab => {
          tab.style.overflow = 'hidden';
          tab.style.maxHeight = '40px';
          tab.style.minHeight = '40px';
        });
      }, 100);
    }
  }

  function qs(sel){ return document.querySelector(sel); }
  function qsa(sel){ return Array.from(document.querySelectorAll(sel)); }

  function findProjectById(projectId){
    return state.projects.find(p => p.id === projectId);
  }

  function setActiveTab(tab){
    state.currentTab = tab;
    qsa('.tab').forEach(btn=>{
      btn.classList.toggle('active', btn.dataset.tab===tab);
      btn.setAttribute('aria-selected', String(btn.dataset.tab===tab));
    });
    qsa('.screen').forEach(s=>{
      const visible = s.dataset.screen===tab;
      s.setAttribute('aria-hidden', String(!visible));
    });
    if(tg){
      // –ù–∞ –æ–±—ã—á–Ω—ã—Ö —ç–∫—Ä–∞–Ω–∞—Ö —Å–∫—Ä—ã–≤–∞–µ–º BackButton
      try{ tg.BackButton.hide(); }catch(e){}
    }
    moveTabIndicator();
    
    // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —ç–∫—Ä–∞–Ω–∞
    analytics.trackScreenView(tab);
  }

  function mountHome(){
    const btn = qs('#screen-home .button.primary');
    btn.addEventListener('click', ()=> { location.hash = '#projects'; });
  }

  function mountAbout(){
    const root = qs('#tech-list');
    root.innerHTML = '';
    state.technologies.forEach(t=>{
      const el = document.createElement('div');
      el.className = 'tech';
      el.innerHTML = `<span>${t.emoji}</span><span class="name">${t.name}</span><span class="level">${t.level}</span>`;
      root.appendChild(el);
    });
  }

  function renderProjectCard(p){
    const card = document.createElement('div');
    card.className = 'project-card';
    card.innerHTML = `
      <div class="project-cover"></div>
      <div class="project-meta">
        <div class="project-title">${p.cardTitle || p.title}</div>
        <div class="project-tag">${p.tag}</div>
      </div>
    `;
    const cover = card.querySelector('.project-cover');
    if(p.cover){ cover.style.backgroundImage = `url('${p.cover}')`; cover.style.backgroundSize='cover'; cover.style.backgroundPosition='center'; }
    card.addEventListener('click', ()=> { 
      // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–∫–∞ –ø–æ –ø—Ä–æ–µ–∫—Ç—É
      analytics.trackInteraction('project_click', { project_id: p.id, project_title: p.title });
      location.hash = `#detail/${p.id}`; 
    });
    return card;
  }

  function mountProjects(){
    const root = qs('#projects-list');
    root.innerHTML = '';
    state.projects.forEach(p=> root.appendChild(renderProjectCard(p)));
    observeInView(root.querySelectorAll('.project-card'));
  }

  function mountServices(){
    const root = qs('#services-list');
    root.innerHTML = '';
    state.services.forEach(s=>{
      const el = document.createElement('div');
      el.className = 'service-card';
      el.innerHTML = `<span class="service-emoji">${s.emoji}</span><div class="service-title">${s.title}</div>`;
      root.appendChild(el);
    });
  }

  function mountContacts(){
    qs('#btn-tg').addEventListener('click', ()=>{
      // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–∫–∞ –ø–æ Telegram
      analytics.trackInteraction('contact_click', { type: 'telegram', value: '@ilgar_x' });
      if(tg){ tg.openTelegramLink('https://t.me/ilgar_x'); }
      else { window.open('https://t.me/ilgar_x','_blank'); }
    });
    qs('#btn-email').addEventListener('click', ()=>{
      // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–∫–∞ –ø–æ email
      analytics.trackInteraction('contact_click', { type: 'email', value: 'pmdpro@yandex.ru' });
      window.location.href = 'mailto:pmdpro@yandex.ru';
    });
    qs('#back-to-projects').addEventListener('click',()=>{location.hash='#projects'})
  }

  function openProjectDetail(p){
    // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π –ø—Ä–æ–µ–∫—Ç–∞
    analytics.trackProjectView(p.id);
    
    qs('#project-title').textContent = p.title;
    qs('#project-desc').textContent = p.desc;
    const cover = qs('#project-cover');
    if(p.cover){ cover.style.backgroundImage = `url('${p.cover}')`; cover.style.backgroundSize='cover'; cover.style.backgroundPosition='center'; }
    const g = qs('#project-gallery');
    g.innerHTML = '';
    p.gallery.forEach(src=>{
      const shot = document.createElement('div');
      shot.className = 'shot';
      shot.style.backgroundImage = `url('${src}')`;
      shot.style.backgroundSize = 'cover';
      shot.style.backgroundPosition = 'center';
      shot.dataset.src = src;
      shot.addEventListener('click', ()=> openLightbox(p.gallery, p.gallery.indexOf(src)));
      g.appendChild(shot);
    });
    observeInView(g.querySelectorAll('.shot'));
    qsa('.screen').forEach(s=> s.setAttribute('aria-hidden','true'));
    qs('#screen-project-detail').setAttribute('aria-hidden','false');
    if(tg){
      try{ tg.BackButton.show(); }catch(e){}
      try{ tg.BackButton.offClick?.(); }catch(e){}
      tg.BackButton.onClick(()=>{ history.back(); });
    }
  }

  // Lightbox slider
  function openLightbox(images, startIndex){
    // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –≥–∞–ª–µ—Ä–µ–∏
    analytics.trackInteraction('gallery_open', { 
      project_id: state.currentTab === 'project-detail' ? 'current' : 'unknown',
      images_count: images.length,
      start_index: startIndex
    });
    
    const lb = qs('#lightbox');
    const img = qs('#lightbox-image');
    const dots = qs('#lightbox-dots');
    let idx = Math.max(0, Math.min(images.length-1, startIndex||0));
    function render(){
      img.src = images[idx];
      dots.innerHTML = '';
      images.forEach((_,i)=>{
        const d = document.createElement('div');
        d.className = 'dot' + (i===idx?' active':'');
        d.addEventListener('click', ()=>{ idx=i; render(); });
        dots.appendChild(d);
      });
    }
    function next(){ idx = (idx+1)%images.length; render(); }
    function prev(){ idx = (idx-1+images.length)%images.length; render(); }
    qs('.lightbox-next').onclick = next;
    qs('.lightbox-prev').onclick = prev;
    qs('.lightbox-close').onclick = close;
    function onKey(e){ if(e.key==='Escape') close(); if(e.key==='ArrowRight') next(); if(e.key==='ArrowLeft') prev(); }
    function onBackdrop(e){ if(e.target===lb) close(); }
    let sx=0, sy=0, touching=false;
    function touchStart(e){ touching=true; sx=e.touches[0].clientX; sy=e.touches[0].clientY; }
    function touchEnd(e){ if(!touching) return; touching=false; const dx=e.changedTouches[0].clientX-sx; const dy=e.changedTouches[0].clientY-sy; if(Math.abs(dx)>50 && Math.abs(dy)<40){ if(dx<0) next(); else prev(); } }
    function close(){
      lb.setAttribute('aria-hidden','true');
      document.removeEventListener('keydown', onKey);
      lb.removeEventListener('click', onBackdrop);
      lb.removeEventListener('touchstart', touchStart);
      lb.removeEventListener('touchend', touchEnd);
    }
    render();
    lb.setAttribute('aria-hidden','false');
    document.addEventListener('keydown', onKey);
    lb.addEventListener('click', onBackdrop);
    lb.addEventListener('touchstart', touchStart, {passive:true});
    lb.addEventListener('touchend', touchEnd);
  }

  function bindTabs(){
    qsa('.tab').forEach(btn=> btn.addEventListener('click', ()=> { location.hash = `#${btn.dataset.tab}`; }));
  }

  function moveTabIndicator(){
    const indicator = qs('.tab-indicator');
    const tabs = qsa('.tab');
    const idx = tabs.findIndex(t => t.dataset.tab === state.currentTab);
    if(!indicator || idx < 0) return;
    
    const tabEl = tabs[idx];
    const tb = tabEl.getBoundingClientRect();
    const pb = tabEl.parentElement.getBoundingClientRect();
    
    // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–∞–±–∞
    const center = tb.left + tb.width/2 - pb.left;
    const indicatorWidth = window.innerWidth <= 380 ? 32 : window.innerWidth <= 320 ? 28 : 36;
    
    indicator.style.left = `${Math.max(16, center - indicatorWidth/2)}px`;
    indicator.style.width = `${indicatorWidth}px`;
  }

  function bindSwipes(){
    const area = qs('#screens');
    let startX = 0, startY = 0, isTouch=false;
    const order = ['home','about','projects','services','contacts'];
    function currentIndex(){ return Math.max(0, order.indexOf(state.currentTab)); }
    function goToIndex(i){ const clamped = Math.max(0, Math.min(order.length-1, i)); location.hash = `#${order[clamped]}`; }
    area.addEventListener('touchstart', (e)=>{ isTouch=true; const t=e.touches[0]; startX=t.clientX; startY=t.clientY; }, {passive:true});
    area.addEventListener('touchend', (e)=>{
      if(!isTouch) return; isTouch=false;
      const t = e.changedTouches[0];
      const dx = t.clientX - startX; const dy = t.clientY - startY;
      if(Math.abs(dx) > 50 && Math.abs(dy) < 40){
        const idx = currentIndex();
        if(dx < 0) goToIndex(idx+1); else goToIndex(idx-1);
      }
    });
  }

  function observeInView(nodes){
    if(!('IntersectionObserver' in window)){
      nodes.forEach?.(n=> n.classList.add('in-view'));
      return;
    }
    const observer = new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          entry.target.classList.add('in-view');
          observer.unobserve(entry.target);
        }
      });
    },{ root:null, rootMargin:'0px 0px -10% 0px', threshold:0.1 });
    nodes.forEach?.(n=> observer.observe(n));
  }

  function navigateFromHash(){
    const hash = (location.hash || '').replace(/^#/, '');
    if(!hash){
      setActiveTab('home');
      return;
    }
    const [route, param] = hash.split('/');
    switch(route){
      case 'home':
      case 'about':
      case 'projects':
      case 'services':
      case 'contacts':
        setActiveTab(route);
        break;
      case 'detail': {
        const project = findProjectById(param);
        if(project){
          openProjectDetail(project);
        } else {
          location.hash = '#projects';
        }
        break;
      }
      default:
        location.hash = '#home';
    }
  }

  function start(){
    const startTime = performance.now();
    
    initTelegram();
    bindTabs();
    bindSwipes();
    mountHome();
    mountAbout();
    mountProjects();
    mountServices();
    mountContacts();
    window.addEventListener('hashchange', navigateFromHash);
    if(!location.hash){
      location.hash = '#home';
    } else {
      navigateFromHash();
    }
    window.setTimeout(moveTabIndicator, 0);
    
    // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    const initTime = performance.now() - startTime;
    analytics.trackPerformance('app_init_time', initTime);
    
    // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
    analytics.trackScreenView('home');
  }
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
  window.addEventListener('error', (e) => {
    analytics.track('error', { 
      message: e.message, 
      filename: e.filename, 
      lineno: e.lineno,
      colno: e.colno
    });
  });
  
  window.addEventListener('unhandledrejection', (e) => {
    analytics.track('error', { 
      type: 'unhandled_promise_rejection',
      reason: e.reason?.toString() || 'Unknown error'
    });
  });

  document.addEventListener('DOMContentLoaded', start);
})();


